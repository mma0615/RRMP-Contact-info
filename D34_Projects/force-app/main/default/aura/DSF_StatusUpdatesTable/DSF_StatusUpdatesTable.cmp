<aura:component implements="forceCommunity:availableForAllPageTypes">
    <aura:attribute name="User" type="Object" default=""/>
    <aura:attribute name="rawTasks" type="List"   default="[]"/>
    <aura:attribute name="Tasks"    type="List"   default="[]"/>
    <aura:attribute name="isLoaded" type="Boolean" default="false"/>

    <!--Design attributes - values received from MyMessages component-->
    <aura:attribute name="TasksTableTitle"   type="String" default=""/>
    <aura:attribute name="TasksTableHeader1" type="String" default=""/>
    <aura:attribute name="TasksTableHeader2" type="String" default=""/>
    <aura:attribute name="NoTasksMessage"    type="String" default=""/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/> 
    <aura:handler name="change" value="{!v.rawTasks}" action="{!c.handleLoadedTasks}"/>
    

    <aura:if isTrue="{! and(v.User != null, v.User.ContactId != null)}">
        <c:DSF_sObjectHelper methodName="getSObject"
                             object="Task"
                             fields="Id,
                                     Subject,
                                     ActivityDate,
                                     Description"
                             conditions="{!'Task.WhoId = \'' + v.User.ContactId + '\''}"
                             orderByFields="CreatedDate DESC"
                             output="{! v.rawTasks  }"
                             />
    </aura:if>
    
    <div class="slds-size_1-of-1 slds-m-vertical_xx-large table-wrap">
        <h3 class="slds-m-bottom_large">{!v.TasksTableTitle}</h3>
        <table>
            <tr class="slds-border_bottom table-header">
                <th class="subject">
                    {!v.TasksTableHeader1}
                </th>
                <th class="date-sent">
                    {!v.TasksTableHeader2}
                </th>
            </tr>
            <aura:if isTrue="{! v.isLoaded}">
            <aura:iteration items="{!v.Tasks}" var="item" start="0" end = "4">
                <tr class="slds-border_bottom">
                    <td class="slds-truncate">
                        <p class="slds-truncate">{!item.Description}</p>
                    </td>
                    <td class="slds-truncate">
                        {!item.ActivityDate}
                    </td>
                </tr>
            </aura:iteration>
            <!--Lightning spinner-->
            <aura:set attribute="else">
                <lightning:spinner alternativeText="Loading" size="medium" />
            </aura:set>
        </aura:if>
        </table>
        <!--Message if there are no related tasks-->
        <aura:if isTrue="{! and(empty(v.rawTasks), v.isLoaded == true) }">
            <p class="slds-align_absolute-center">{!v.NoTasksMessage}</p>
        </aura:if>
    </div>
</aura:component>